<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Daily Price Trends</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h1>Daily Price Trends by Category</h1>
    <canvas id="priceChart" width="800" height="400"></canvas>
    <script>
        // Parse chart_data passed from Flask
        const chartData = JSON.parse('{{ chart_data | safe }}');
        const datasets = [];
        let labels = [];

        // Use the dates from the first category as labels.
        const categories = Object.keys(chartData);
        if (categories.length > 0) {
            labels = chartData[categories[0]].dates;
        }

        // Create a dataset for each category with a random color.
        categories.forEach(category => {
            datasets.push({
                label: category,
                data: chartData[category].prices,
                fill: false,
                borderColor: '#' + Math.floor(Math.random() * 16777215).toString(16),
                tension: 0.1
            });
        });

        const ctx = document.getElementById('priceChart').getContext('2d');
        const priceChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: datasets
            },
            options: {
                scales: {
                    x: {
                        title: { display: true, text: 'Date' }
                    },
                    y: {
                        title: { display: true, text: 'Average Price (BRL)' }
                    }
                }
            }
        });
    </script>
</body>
</html>
